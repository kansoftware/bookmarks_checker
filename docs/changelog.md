# Дневник проекта

## 2025-05-31

### Добавлено
- Реализована асинхронная проверка URL в отдельном потоке
- Добавлена возможность остановки проверки
- Реализовано логирование результатов проверки в GUI
- Добавлена обработка ошибок при проверке URL

### Изменено
- Улучшен механизм парсинга закладок для корректной обработки URL
- Оптимизирована работа с асинхронными операциями

### Исправлено
- Исправлена ошибка при обработке закладок в GUI
- Улучшена обработка ошибок при парсинге файла закладок

## 2025-06-01

### Наблюдения
- Проект требует четкой структуры для удобной разработки
- Необходимо учитывать различные форматы закладок браузеров
- Важна производительность при проверке большого количества URL
- Требуется поддержка многопоточной обработки
- Необходима возможность приостановки/возобновления проверки

### Решения
- Выбрана модульная архитектура с четким разделением ответственности
- Решено использовать асинхронные запросы для проверки URL
- Принято решение о сохранении иерархии закладок в markdown файлах
- Добавлен компонент кэширования для сохранения прогресса
- Выбрана интеграция с openrouter.ai для извлечения ключевых слов и описания

### Проблемы
- Необходимо решить вопрос с обработкой недоступных URL
- Требуется определить оптимальный способ извлечения ключевых слов
- Нужно продумать механизм обновления существующих markdown файлов
- Необходимо реализовать безопасную обработку потенциально опасных URL
- Требуется оптимизировать многопоточную обработку URL

### Добавлено
- Расширенная обработка различных типов ошибок (SSL, сетевые, таймауты)
- Система сбора метрик для мониторинга успешности запросов
- Измерение времени ответа для каждого URL
- Отслеживание количества попыток повторного подключения

### Изменено
- Улучшен механизм повторных попыток с более гибкой конфигурацией
- Обновлена модель URLResponse с дополнительными полями для метрик
- Улучшено логирование ошибок с более детальной информацией

### Исправлено
- Добавлена корректная обработка SSL-ошибок
- Улучшена обработка сетевых ошибок
- Оптимизирована работа с таймаутами

## [2025-06-02] - Рефакторинг URLChecker: учёт попыток и метрик
### Изменено
- Переписан механизм учёта количества попыток (retry_count) при проверке URL
- Исправлена обработка ошибок: теперь после максимального количества попыток возвращается корректный результат, а не исключение
- Метрики разделены на уникальные запросы (unique_requests) и общее количество попыток (total_requests)

## [2025-06-02] - Стабилизация unit-тестов config и logger
### Исправлено
- Исправлены тесты и реализация для config: корректная сериализация/десериализация, поддержка всех необходимых полей
- Улучшен setup_logger: добавлена поддержка log_file и корректная работа с уровнями логирования
- Все unit-тесты для config и logger теперь проходят

## [2025-06-03] - Начало реализации поддержки редиректов
### Добавлено
- Начата реализация функционала следования редиректам при проверке URL.

## [2025-06-04] - Добавлено главное меню и сохранение настроек

### Добавлено
- Главное меню с пунктами:
  - Завершить работу
  - Настройки LLM
  - Об авторе (ссылка на kansoftware.ru)
- Сохранение и загрузка настроек в ~/.config/BookmarksChecker.json
- Окно настроек LLM с возможностью настройки модели, API ключа и базового URL
- Автоматическое сохранение размера и позиции окна
- Генерация markdown файлов с сохранением иерархии

### Изменено
- Обновлен класс конфигурации для поддержки сохранения настроек
- Улучшена структура кода с разделением на модули

### Исправлено
- Исправлено сохранение настроек при закрытии приложения

## [2025-06-05] - Добавлена конвертация в markdown

### Добавлено
- Реализована конвертация HTML страниц в markdown формат
- Добавлено сохранение результатов в структурированном виде
- Реализована многопоточная обработка контента
- Добавлено отслеживание процесса обработки в JSON файле
- Добавлена возможность возобновления обработки с места остановки
- Добавлены настройки обработки контента (сохранение изображений, ссылок, метаданных)
- Реализовано извлечение метаданных из страниц (заголовки, описания, ключевые слова)
- Добавлена поддержка относительных ссылок и изображений
- Добавлена обработка таблиц и списков
- Реализована безопасная работа с файлами в многопоточном режиме

### Изменено
- Обновлен интерфейс главного окна
- Добавлен прогресс-бар для отображения процесса обработки
- Улучшена обработка ошибок и логирование
- Расширены настройки конфигурации

### Исправлено
- Исправлена обработка кодировок
- Улучшена обработка некорректного HTML
- Исправлена работа с путями в Windows

## [2025-06-05] - Улучшена обработка контента

### Добавлено
- Улучшена обработка различных типов контента
- Добавлена поддержка text/plain и нестандартных типов контента
- Добавлена попытка распознавания HTML независимо от content-type

### Изменено
- Улучшена обработка кодировок
- Добавлено более подробное логирование процесса обработки

### Исправлено
- Исправлена проблема с обработкой страниц с нестандартным content-type
- Улучшена обработка ошибок при парсинге HTML

## [2025-06-05] - Улучшена обработка некорректного HTML

### Добавлено
- Добавлен метод _process_links для обработки ссылок в HTML
- Добавлена обработка ошибок при парсинге HTML
- Добавлена возможность сохранения некорректного HTML как текста

### Изменено
- Улучшена обработка ошибок в MarkdownGenerator
- Улучшена конвертация HTML в markdown с использованием html2text
- Добавлена более детальная обработка ошибок при работе с HTML

### Исправлено
- Исправлена проблема с обработкой некорректного HTML
- Исправлена проблема с отсутствующим методом _process_links

## [2025-06-05] - Улучшено форматирование markdown и обработка путей

### Добавлено
- Добавлена обработка таблиц с разделителями заголовков
- Добавлена обработка нумерованных и ненумерованных списков
- Добавлены свойства для работы с путями в Config

### Изменено
- Улучшено форматирование ссылок и изображений
- Улучшена обработка путей в Config
- Улучшена обработка URL в ContentProcessor

### Исправлено
- Исправлено форматирование таблиц в markdown
- Исправлено форматирование списков в markdown
- Исправлено форматирование ссылок в markdown
- Исправлено форматирование изображений в markdown
- Исправлена обработка путей в Config

## [2025-06-05] - Улучшена обработка метаданных и ссылок

### Добавлено
- Добавлена обработка мета-тегов (description, keywords)
- Добавлено отображение источника страницы
- Добавлена обработка вложенных списков

### Изменено
- Улучшена обработка ссылок (пропуск javascript: ссылок)
- Улучшена обработка списков с вложенными элементами
- Улучшено форматирование метаданных

### Исправлено
- Исправлена обработка javascript: ссылок
- Исправлена обработка вложенных списков
- Исправлено форматирование метаданных

## [2025-06-05] - Улучшение обработки нумерованных списков

### Изменено
- Улучшена обработка нумерованных списков в MarkdownGenerator
- Добавлена поддержка атрибута start для нумерованных списков
- Улучшено форматирование вложенных списков
- Исправлено сохранение форматирования inline-элементов в списках

### Технические детали
- Добавлен параметр parent_counter в метод _process_list для корректной нумерации вложенных списков
- Оптимизирована обработка inline-элементов в списках
- Улучшена обработка пустых элементов списка

## [2025-06-05] - Исправление ошибок в тестах

### Исправлено
- Исправлена логика метода `get_pending_urls()` в ProcessingTracker для корректного возобновления обработки
- Исправлено форматирование нумерованных списков в MarkdownGenerator (теперь `<ol>` корректно преобразуется в `1. 2. 3.` вместо `- - -`)
- Исправлены тесты для корректной проверки нумерованных списков

### Изменено
- Обновлена логика фильтрации URL в `get_pending_urls()`: теперь включает URL со статусом "pending" и "checked" с успешным результатом проверки
- Улучшено форматирование отступов в списках (используется 2 пробела вместо 4)
- Оптимизирована обработка вложенных списков в markdown

### Технические детали
- Все 56 тестов теперь проходят успешно
- Покрытие кода составляет 79%
- Исправлены проблемы с возобновлением обработки URL после перезапуска приложения

## [2025-06-05] - Исправление ошибки импорта

### Исправлено
- Исправлена ошибка ImportError в content_processor.py: заменен относительный импорт `from ..markdown_generator import MarkdownGenerator` на абсолютный `from markdown_generator import MarkdownGenerator`
- Приложение теперь корректно запускается без ошибок импорта

### Технические детали
- Проблема возникала из-за того, что при запуске скрипта напрямую через `python3 src/main.py`, Python не мог правильно разрешить относительный импорт
- Использование абсолютного импорта решает проблему совместимости с различными способами запуска приложения

## [2025-06-05] - Установка отсутствующей зависимости

### Добавлено
- Установлен пакет `markdown-generator` для устранения `ModuleNotFoundError`.
